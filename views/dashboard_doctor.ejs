<%- include('partials/header') %>
<%- include('partials/flash') %>
<!doctype html><html><body>
<div class="wrap">
<h2>Today’s Queue</h2>

<div class="row" style="margin-bottom:12px">
  <div class="card" style="flex:1 1 260px">
    <h3>Visit settings</h3>
    <p>Visit duration (min): <b><%= visit_duration %></b></p>
    <form method="post" action="/doctor/running-late" style="display:flex;gap:8px;align-items:center">
      <%- include('partials/csrf') %>
      <label>Running late (+min)</label>
      <input type="number" name="minutes" value="<%= running_late %>" min="0" style="width:90px">
      <button>Save</button>
    </form>
  </div>
</div>

<table>
  <tr>
    <th>Time</th><th>Clinic</th><th>Patient</th><th>Status</th><th>Room</th><th>Actions</th>
  </tr>
  <% rows.forEach(r=>{ %>
  <tr>
    <td><%= r.slot_time %></td>
    <td><%= r.clinic_name||'—' %></td>
    <td><%= r.patient_name %></td>
    <td><%= r.status %></td>
    <td>
      <form method="post" action="/doctor/appointments/<%= r.id %>/room">
        <%- include('partials/csrf') %>
        <input name="room" value="<%= r.room||'' %>" placeholder="Room #"><button>Save</button>
      </form>
    </td>
    <td style="white-space:nowrap">
      <a href="/doctor/appointments/<%= r.id %>/edit">Visit</a>
      | <a href="/appointments/<%= r.id %>/print" target="_blank">Print</a>
      <form method="post" action="/doctor/appointments/<%= r.id %>/call" style="display:inline">
        <%- include('partials/csrf') %>
        <button>Call</button>
      </form>
      <form method="post" action="/doctor/appointments/<%= r.id %>/start" style="display:inline">
        <%- include('partials/csrf') %>
        <button>Start</button>
      </form>
      <form method="post" action="/doctor/appointments/<%= r.id %>/done" style="display:inline">
        <%- include('partials/csrf') %>
        <button>Done</button>
      </form>
      <form method="post" action="/doctor/appointments/<%= r.id %>/noshow" style="display:inline">
        <%- include('partials/csrf') %>
        <button>No-show</button>
      </form>
    </td>
  </tr>
  <% }) %>
</table>
</div>
<%- include('_footer') %>
</body></html>
