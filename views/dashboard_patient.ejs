<%- include('partials/header') %>
<%- include('partials/flash') %>
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Patient Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <div class="wrap">
      <h2>My Appointments</h2>

      <div class="row">
        <div class="card" style="flex:1 1 420px">
          <h3>Upcoming</h3>
          <% if (!upcoming.length) { %>
            <p>No upcoming visits. <a href="/doctors">Find a doctor</a></p>
          <% } else { %>
            <table>
              <tr><th>Date</th><th>Time</th><th>Doctor</th><th>Clinic</th><th>Status</th><th>Links</th></tr>
              <% upcoming.forEach(a=>{ %>
                <tr>
                  <td><%= a.appt_date %></td>
                  <td><%= a.slot_time %></td>
                  <td><%= a.doctor_name %></td>
                  <td><%= a.clinic_name||'—' %></td>
                  <td><%= a.status %></td>
                  <td style="white-space:nowrap">
                    <a href="/appointments/<%= a.id %>/status">Live status</a>
                    | <a href="/appointments/<%= a.id %>/intake">Intake form</a>
                    | <a href="/appointments/<%= a.id %>/files">Files</a>
                    | <a href="/appointments/<%= a.id %>/print" target="_blank">Print</a>
                    | <a href="/doctors/<%= a.doctor_id %>">Doctor</a>
                  </td>
                </tr>
              <% }) %>
            </table>
          <% } %>
        </div>

        <div class="card" style="flex:1 1 420px">
          <h3>Past</h3>
          <% if (!past.length) { %>
            <p>No past visits yet.</p>
          <% } else { %>
            <table>
              <tr><th>Date</th><th>Time</th><th>Doctor</th><th>Clinic</th><th>Status</th><th>Files</th></tr>
              <% past.forEach(a=>{ %>
                <tr>
                  <td><%= a.appt_date %></td>
                  <td><%= a.slot_time %></td>
                  <td><%= a.doctor_name %></td>
                  <td><%= a.clinic_name||'—' %></td>
                  <td><%= a.status %></td>
                  <td style="white-space:nowrap">
                    <a href="/appointments/<%= a.id %>/print" target="_blank">Print summary</a>
                    | <a href="/appointments/<%= a.id %>/files">Files</a>
                  </td>
                </tr>
              <% }) %>
            </table>
          <% } %>
        </div>
      </div>
    </div>
    <%- include('_footer') %>
  </body>
</html>
