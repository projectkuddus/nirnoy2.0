<%- include('partials/header') %>
<%- include('partials/flash') %>

<div class="wrap booking-page">
  <header class="page-header">
    <p class="eyebrow">Book an appointment</p>
    <h1>
      <%= doctor && doctor.name ? doctor.name : 'Doctor' %>
    </h1>
    <p class="page-subtitle">
      <%= doctor && doctor.specialty ? doctor.specialty : 'Consultation' %>
      <% if (doctor && doctor.area) { %>
        · <span><%= doctor.area %></span>
      <% } %>
    </p>
  </header>

  <% const formAction = '/book'; %>
  <section class="booking-layout">
    <form method="post" action="<%= formAction %>" class="card booking-form">
      <%- include('partials/csrf') %>
      <input type="hidden" name="doctorId" value="<%= doctor && doctor.uid ? doctor.uid : '' %>">

      <div class="booking-form__row">
        <div class="field">
          <label for="clinicId">Clinic / hospital</label>
          <select id="clinicId" name="clinicId" required>
            <option value="">Choose a location</option>
            <% if (clinics && clinics.length) { %>
              <% clinics.forEach(c => { %>
                <option value="<%= c.id %>" <%= (selectedClinicId && String(selectedClinicId) === String(c.id)) ? 'selected' : '' %>>
                  <%= c.name %>
                  <% if (c.city) { %> — <%= c.city %><% } %>
                </option>
              <% }) %>
            <% } %>
          </select>
        </div>

        <div class="field">
          <label for="appt_date">Date</label>
          <input
            type="date"
            id="appt_date"
            name="appt_date"
            value="<%= selectedDate || '' %>"
            required
          >
        </div>
      </div>

      <div class="booking-form__row">
        <div class="field field--full">
          <label>Choose a time slot</label>
          <% if (!slots || !slots.length) { %>
            <p class="empty">No slots defined yet for this doctor.</p>
          <% } else { %>
            <div class="slot-grid">
              <% slots.forEach(s => { %>
                <label class="slot-pill">
                  <input type="radio" name="slot_time" value="<%= s %>" required>
                  <span><%= s %></span>
                </label>
              <% }) %>
            </div>
          <% } %>
        </div>
      </div>

      <div class="booking-form__actions booking-actions">
        <button type="submit" class="btn primary">
          Confirm appointment
        </button>
        <a href="/doctors/<%= doctor && doctor.did ? doctor.did : '' %>" class="btn ghost">
          Back to profile
        </a>
      </div>
    </form>
  </section>
</div>

<%- include('_footer') %>
