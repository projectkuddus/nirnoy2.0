<%- include('partials/header') %>
<%- include('partials/flash') %>

<div class="wrap doctors-page">
  <header class="page-header">
    <p class="eyebrow">Find a doctor</p>
    <h1>Doctors in Dhaka</h1>
    <p class="page-subtitle">
      Search by name, specialty, hospital or area. Book online with doctors who are live on Nirnoy.
    </p>
  </header>

  <section class="doctors-filters">
    <form method="get" action="/doctors" class="doctors-search-form">
      <div class="field field--full">
        <label for="q">Search</label>
        <input
          id="q"
          type="text"
          name="q"
          value="<%= selected && selected.q ? selected.q : '' %>"
          placeholder="Type name, specialty, hospital or area…"
        >
      </div>

      <div class="doctors-filters__row">
        <div class="field">
          <label for="area">Area</label>
          <select id="area" name="area">
            <option value="">Any area</option>
            <% if (filters && filters.areas) { %>
              <% filters.areas.forEach(a => { %>
                <option value="<%= a %>" <%= selected.area === a ? 'selected' : '' %>><%= a %></option>
              <% }) %>
            <% } %>
          </select>
        </div>

        <div class="field">
          <label for="hospital">Hospital / clinic</label>
          <select id="hospital" name="hospital">
            <option value="">Any hospital</option>
            <% if (filters && filters.hospitals) { %>
              <% filters.hospitals.forEach(h => { %>
                <option value="<%= h %>" <%= selected.hospital === h ? 'selected' : '' %>><%= h %></option>
              <% }) %>
            <% } %>
          </select>
        </div>

        <div class="field">
          <label for="specialty">Specialty</label>
          <select id="specialty" name="specialty">
            <option value="">Any specialty</option>
            <% if (filters && filters.specialties) { %>
              <% filters.specialties.forEach(s => { %>
                <option value="<%= s %>" <%= selected.specialty === s ? 'selected' : '' %>><%= s %></option>
              <% }) %>
            <% } %>
          </select>
        </div>

        <div class="field field--actions">
          <button type="submit" class="btn primary">Search</button>
        </div>
      </div>
    </form>
  </section>

  <% if (!doctors || !doctors.length) { %>
    <p class="empty">
      No doctors found for this filter. Try clearing some filters or changing your search text.
    </p>
  <% } else { %>
    <section class="doctors-grid">
      <% doctors.forEach(d => { %>
        <article class="doctor-card">
          <header class="doctor-card__header">
            <h2 class="doctor-card__name">
              <%= d.display_name || d.full_name || d.name %>
            </h2>
            <p class="doctor-card__specialty">
              <%= d.specialty || 'General consultation' %>
            </p>
            <% if (d.area || d.clinic_city) { %>
              <p class="doctor-card__meta">
                <span><%= d.area || d.clinic_city %></span>
              </p>
            <% } %>
            <% if (d.clinic_name) { %>
              <p class="doctor-card__meta">
                <span><%= d.clinic_name %></span>
              </p>
            <% } %>
          </header>

          <footer class="doctor-card__footer">
            <% if (d.canBook) { %>
              <span class="doctor-card__badge doctor-card__badge--live">
                Online booking via Nirnoy
              </span>
              <div class="doctor-card__actions">
                <a href="<%= d.did ? '/doctors/' + d.did : '#' %>" class="btn ghost btn-xs">View profile</a>
                <a href="<%= d.uid ? ('/book?doctorId=' + d.uid) : '#' %>" class="btn primary btn-xs">Book</a>
              </div>
            <% } else { %>
              <span class="doctor-card__badge">
                Public listing — not yet online
              </span>
            <% } %>
          </footer>
        </article>
      <% }) %>
    </section>
  <% } %>
</div>

<%- include('_footer') %>
