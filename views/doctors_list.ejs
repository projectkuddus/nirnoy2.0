<%- include('partials/header') %>
<%- include('partials/flash') %>

<div class="wrap doctor-directory">
  <header class="page-header">
    <p class="eyebrow">Find a doctor</p>
    <h1>Search doctors in Dhaka</h1>
    <p class="page-subtitle">
      Browse by hospital, specialty and area. Sign in only when you’re ready to book.
    </p>
  </header>

  <!-- Search + filters -->
  <form method="get" action="/doctors" class="doctor-filters">
    <div class="doctor-filters__row">
      <div class="field field--wide">
        <input
          type="text"
          name="q"
          placeholder="Search by name, specialty, hospital…"
          value="<%= selected && selected.q ? selected.q : '' %>"
        />
      </div>

      <div class="field">
        <select name="specialty">
          <option value="">All specialties</option>
          <% if (filters && filters.specialties) { %>
            <% filters.specialties.forEach(s => { %>
              <option value="<%= s %>" <%= selected.specialty === s ? 'selected' : '' %>><%= s %></option>
            <% }) %>
          <% } %>
        </select>
      </div>

      <div class="field">
        <select name="area">
          <option value="">All areas</option>
          <% if (filters && filters.areas) { %>
            <% filters.areas.forEach(a => { %>
              <option value="<%= a %>" <%= selected.area === a ? 'selected' : '' %>><%= a %></option>
            <% }) %>
          <% } %>
        </select>
      </div>

      <div class="field">
        <select name="hospital">
          <option value="">All clinics / hospitals</option>
          <% if (filters && filters.hospitals) { %>
            <% filters.hospitals.forEach(h => { %>
              <option value="<%= h %>" <%= selected.hospital === h ? 'selected' : '' %>><%= h %></option>
            <% }) %>
          <% } %>
        </select>
      </div>

      <div class="field">
        <select name="sort">
          <option value="">Sort: A–Z</option>
          <option value="fee_asc" <%= selected.sort === 'fee_asc' ? 'selected' : '' %>>Fee: low to high</option>
          <option value="fee_desc" <%= selected.sort === 'fee_desc' ? 'selected' : '' %>>Fee: high to low</option>
        </select>
      </div>

      <div class="field">
        <button type="submit" class="btn primary">Search</button>
      </div>
    </div>
  </form>

  <!-- Results -->
  <% if (!doctors || !doctors.length) { %>
    <p class="empty">No doctors match your search yet.</p>
  <% } else { %>
    <div class="doctor-grid">
      <% doctors.forEach(d => { %>
        <article class="doctor-card <%= d.source === 'directory' ? 'doctor-card--directory' : '' %>">
          <% if (d.photo_url) { %>
            <div class="doctor-card__photo">
              <img src="<%= d.photo_url %>" alt="Photo of <%= d.name %>">
            </div>
          <% } %>
          <div class="doctor-card__body">
            <% if (d.source === 'nirnoy' && d.did) { %>
              <h2>
                <a href="/doctors/<%= d.did %>" class="doctor-card__name-link">
                  <%= d.name %>
                </a>
              </h2>
            <% } else { %>
              <h2 class="doctor-card__name">
                <%= d.name %>
              </h2>
            <% } %>
            <p class="doctor-card__meta">
              <span><%= d.specialty || 'General physician' %></span>
              <% if (d.area || d.clinic_city) { %>
                · <span><%= d.area || d.clinic_city %></span>
              <% } %>
            </p>
            <% if (d.clinic_name) { %>
              <p class="doctor-card__clinic">
                <%= d.clinic_name %>
              </p>
            <% } %>
            <% if (d.fee) { %>
              <p class="doctor-card__fee">
                ৳ <%= d.fee %> per visit
              </p>
            <% } %>
            <% if (d.source === 'directory') { %>
              <p class="doctor-card__badge">
                Public listing — not yet online with Nirnoy
              </p>
              <div class="doctor-card__actions">
                <button type="button" class="btn ghost" disabled>
                  Not bookable yet
                </button>
              </div>
            <% } else { %>
              <div class="doctor-card__actions">
                <a href="/doctors/<%= d.did %>" class="btn ghost">View profile</a>
                <a href="/book?doctorId=<%= d.uid %>" class="btn primary">Book</a>
              </div>
            <% } %>
          </div>
        </article>
      <% }) %>
    </div>
  <% } %>
</div>

<%- include('_footer') %>
